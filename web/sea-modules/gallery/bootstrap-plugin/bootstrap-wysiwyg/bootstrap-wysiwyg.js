define("gallery/bootstrap-plugin/bootstrap-wysiwyg/bootstrap-wysiwyg",["jquery"],function(a){a("jquery"),function(a){"use strict";var b=function(b){var c=a.Deferred(),d=new FileReader;return d.onload=function(a){c.resolve(a.target.result)},d.onerror=c.reject,d.onprogress=c.notify,d.readAsDataURL(b),c.promise()};a.fn.cleanHtml=function(){var b=a(this).html();return b&&b.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},a.fn.wysiwyg=function(c){var e,f,g,d=this,h=function(){f.activeToolbarClass&&a(f.toolbarSelector).find(g).each(function(){var b=a(this).data(f.commandRole);try{b&&document.queryCommandState&&document.queryCommandState(b)?a(this).addClass(f.activeToolbarClass):a(this).removeClass(f.activeToolbarClass)}catch(c){}})},i=function(a,b){var c=a.split(" "),d=c.shift(),e=c.join(" ")+(b||"");document.execCommand(d,0,e),h()},j=function(b){a.each(b,function(a,b){d.keydown(a,function(a){d.attr("contenteditable")&&d.is(":visible")&&(a.preventDefault(),a.stopPropagation(),i(b))}).keyup(a,function(a){d.attr("contenteditable")&&d.is(":visible")&&(a.preventDefault(),a.stopPropagation())})})},k=function(){var a=window.getSelection();return a.getRangeAt&&a.rangeCount?a.getRangeAt(0):void 0},l=function(){e=k()},m=function(){var a=window.getSelection();if(e){try{a.removeAllRanges()}catch(b){document.body.createTextRange().select(),document.selection.empty()}a.addRange(e)}},n=function(c){d.focus(),a.each(c,function(c,d){/^image\//.test(d.type)?a.when(b(d)).done(function(a){i("insertimage",a)}).fail(function(a){f.fileUploadError("file-reader",a)}):f.fileUploadError("unsupported-file-type",d.type)})},o=function(a,b){m(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,b||"transparent"),l(),a.data(f.selectionMarker,b)},p=function(b,c){b.find(g).click(function(){m(),d.focus(),i(a(this).data(c.commandRole)),l()}),b.find("[data-toggle=dropdown]").click(m),b.find("input[type=text][data-"+c.commandRole+"]").on("webkitspeechchange change",function(){var b=this.value;this.value="",m(),b&&(d.focus(),i(a(this).data(c.commandRole),b)),l()}).on("focus",function(){var b=a(this);b.data(c.selectionMarker)||(o(b,c.selectionColor),b.focus())}).on("blur",function(){var b=a(this);b.data(c.selectionMarker)&&o(b,!1)}),b.find("input[type=file][data-"+c.commandRole+"]").change(function(){m(),"file"===this.type&&this.files&&this.files.length>0&&n(this.files),l(),this.value=""})},q=function(){d.on("dragenter dragover",!1).on("drop",function(a){var b=a.originalEvent.dataTransfer;a.stopPropagation(),a.preventDefault(),b&&b.files&&b.files.length>0&&n(b.files)})};return f=a.extend({},a.fn.wysiwyg.defaults,c),g="a[data-"+f.commandRole+"],button[data-"+f.commandRole+"],input[type=button][data-"+f.commandRole+"]",j(f.hotKeys),f.dragAndDropImages&&q(),p(a(f.toolbarSelector),f),d.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){l(),h()}),a(window).bind("touchend",function(a){var b=d.is(a.target)||d.has(a.target).length>0,c=k(),e=c&&c.startContainer===c.endContainer&&c.startOffset===c.endOffset;(!e||b)&&(l(),h())}),this},a.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(a,b){console.log("File upload error",a,b)}}}(window.jQuery)});