define("gallery/backbone-plugin/backbone-deepmodel/backbone-deepmodel",["underscore","backbone"],function(a,b,c){!function(){var d,e,f,g,h,i,b=a("backbone"),c=a("underscore"),j=[].slice;f=function(a){var d,e;return!c.isObject(a)||c.isFunction(a)?a:a instanceof b.Collection||a instanceof b.Model?a:c.isDate(a)?new Date(a.getTime()):c.isRegExp(a)?new RegExp(a.source,a.toString().replace(/.*\//,"")):(e=c.isArray(a||c.isArguments(a)),d=function(a,b,c){return e?a.push(f(b)):a[c]=f(b),a},c.reduce(a,d,e?[]:{}))},i=function(a){return null==a?!1:!(a.prototype!=={}.prototype&&a.prototype!==Object.prototype||!c.isObject(a)||c.isArray(a)||c.isFunction(a)||c.isDate(a)||c.isRegExp(a)||c.isArguments(a))},e=function(a){return c.filter(c.keys(a),function(b){return i(a[b])})},d=function(a){return c.filter(c.keys(a),function(b){return c.isArray(a[b])})},h=function(a,b,f){var g,i,j,k,l,m,n,o,p,q;if(null==f&&(f=20),0>=f)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),c.extend(a,b);for(m=c.intersection(e(a),e(b)),i=function(c){return b[c]=h(a[c],b[c],f-1)},n=0,p=m.length;p>n;n++)l=m[n],i(l);for(k=c.intersection(d(a),d(b)),g=function(d){return b[d]=c.union(a[d],b[d])},o=0,q=k.length;q>o;o++)j=k[o],g(j);return c.extend(a,b)},g=function(){var a,b,d,e;if(d=2<=arguments.length?j.call(arguments,0,e=arguments.length-1):(e=0,[]),b=arguments[e++],c.isNumber(b)||(d.push(b),b=20),d.length<=1)return d[0];if(0>=b)return c.extend.apply(this,d);for(a=d.shift();d.length>0;)a=h(a,f(d.shift()),b);return a},c.mixin({deepClone:f,isBasicObject:i,basicObjects:e,arrays:d,deepExtend:g})}.call(this),function(b,d){function e(a){var c={},d=i.keyPathSeparator;for(var f in a){var g=a[f];if(g&&g.constructor===Object&&!b.isEmpty(g)){var h=e(g);for(var j in h){var k=h[j];c[f+d+j]=k}}else c[f]=g}return c}function f(a,c,d){for(var e=i.keyPathSeparator,f=c.split(e),g=a,h=0,j=f.length;j>h;h++){if(d&&!b.has(g,f[h]))return!1;if(g=g[f[h]],null==g&&j-1>h&&(g={}),"undefined"==typeof g)return d?!0:g}return d?!0:g}function g(a,c,d,e){e=e||{};for(var f=i.keyPathSeparator,g=c.split(f),h=a,j=0,k=g.length;k>j&&void 0!==h;j++){var l=g[j];j===k-1?e.unset?delete h[l]:h[l]=d:("undefined"!=typeof h[l]&&b.isObject(h[l])||(h[l]={}),h=h[l])}}function h(a,b){g(a,b,null,{unset:!0})}var d=a("backbone"),b=a("underscore"),i=d.Model.extend({constructor:function(a,c){var d,e=a||{};this.cid=b.uniqueId("c"),this.attributes={},c&&c.collection&&(this.collection=c.collection),c&&c.parse&&(e=this.parse(e,c)||{}),(d=b.result(this,"defaults"))&&(e=b.deepExtend({},d,e)),this.set(e,c),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(){return b.deepClone(this.attributes)},get:function(a){return f(this.attributes,a)},set:function(a,c,d){var j,k,l,m,n,o,p,q;if(null==a)return this;if("object"==typeof a?(k=a,d=c||{}):(k={})[a]=c,d||(d={}),!this._validate(k,d))return!1;l=d.unset,n=d.silent,m=[],o=this._changing,this._changing=!0,o||(this._previousAttributes=b.deepClone(this.attributes),this.changed={}),q=this.attributes,p=this._previousAttributes,this.idAttribute in k&&(this.id=k[this.idAttribute]),k=e(k);for(j in k)c=k[j],b.isEqual(f(q,j),c)||m.push(j),b.isEqual(f(p,j),c)?h(this.changed,j):g(this.changed,j,c),l?h(q,j):g(q,j,c);if(!n){m.length&&(this._pending=!0);for(var r=i.keyPathSeparator,s=0,t=m.length;t>s;s++){var a=m[s];this.trigger("change:"+a,this,f(q,a),d);for(var u=a.split(r),v=u.length-1;v>0;v--){var w=b.first(u,v).join(r),x=w+r+"*";this.trigger("change:"+x,this,f(q,w),d)}}}if(o)return this;if(!n)for(;this._pending;)this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},clear:function(a){var c={},d=e(this.attributes);for(var f in d)c[f]=void 0;return this.set(c,b.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!b.isEmpty(this.changed):void 0!==f(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?e(this.changed):!1;var c=this._changing?this._previousAttributes:this.attributes;a=e(a),c=e(c);var d,f=!1;for(var g in a)b.isEqual(c[g],d=a[g])||((f||(f={}))[g]=d);return f},previous:function(a){return null!=a&&this._previousAttributes?f(this._previousAttributes,a):null},previousAttributes:function(){return b.deepClone(this._previousAttributes)}});i.keyPathSeparator=".","undefined"!=typeof c&&(c.exports=i)}()});
define("gallery/backbone-plugin/backbone-collectionbinder/backbone-collectionbinder",["backbone","underscore"],function(a){!function(){var b=a("backbone"),c=a("underscore");if(!b)throw"Please include Backbone.js before Backbone.ModelBinder.js";if(!b.ModelBinder)throw"Please include Backbone.ModelBinder.js before Backbone.CollectionBinder.js";b.CollectionBinder=function(a,b){if(c.bindAll(this),this._elManagers={},this._elManagerFactory=a,!this._elManagerFactory)throw"elManagerFactory must be defined.";this._elManagerFactory.trigger=this.trigger,this._options=b||{}},b.CollectionBinder.VERSION="1.0.1",c.extend(b.CollectionBinder.prototype,b.Events,{bind:function(a,b){if(this.unbind(),!a)throw"collection must be defined";if(!b)throw"parentEl must be defined";this._collection=a,this._elManagerFactory.setParentEl(b),this._onCollectionReset(),this._collection.on("add",this._onCollectionAdd,this),this._collection.on("remove",this._onCollectionRemove,this),this._collection.on("reset",this._onCollectionReset,this),this._collection.on("sort",this._onCollectionSort,this)},unbind:function(){void 0!==this._collection&&(this._collection.off("add",this._onCollectionAdd),this._collection.off("remove",this._onCollectionRemove),this._collection.off("reset",this._onCollectionReset),this._collection.off("sort",this._onCollectionSort)),this._removeAllElManagers()},getManagerForEl:function(a){var b,d,e=c.values(this._elManagers);for(b=0;b<e.length;b++)if(d=e[b],d.isElContained(a))return d;return void 0},getManagerForModel:function(a){return this._elManagers[c.isObject(a)?a.cid:a]},_onCollectionAdd:function(a){var b=this._isModelToInsert(a);this._elManagers[a.cid]=b?this._elManagerFactory.makeElManager(a,b.getEl()):this._elManagerFactory.makeElManager(a),this._elManagers[a.cid].createEl(),this._options.autoSort&&this.sortRootEls()},_isModelToInsert:function(a){var b=this._collection.indexOf(a);if(0===b){var c=this._collection.at(b+1),d=c&&this._elManagers[c.cid];return d}return!1},_onCollectionRemove:function(a){this._removeElManager(a)},_onCollectionReset:function(){this._removeAllElManagers(),this._collection.each(function(a){this._onCollectionAdd(a)},this),this.trigger("elsReset",this._collection)},_onCollectionSort:function(){this._options.autoSort&&this.sortRootEls()},_removeAllElManagers:function(){c.each(this._elManagers,function(a){a.removeEl(),delete this._elManagers[a._model.cid]},this),delete this._elManagers,this._elManagers={}},_removeElManager:function(a){void 0!==this._elManagers[a.cid]&&(this._elManagers[a.cid].removeEl(),delete this._elManagers[a.cid])},sortRootEls:function(){this._collection.each(function(a,b){var c=this.getManagerForModel(a);if(c){var d=c.getEl(),e=$(this._elManagerFactory.getParentEl()).children();e[b]!==d[0]&&(d.detach(),d.insertBefore(e[b]))}},this)}}),b.CollectionBinder.ElManagerFactory=function(a,b){if(c.bindAll(this),this._elHtml=a,this._bindings=b,!c.isString(this._elHtml))throw"elHtml must be a valid html string"},c.extend(b.CollectionBinder.ElManagerFactory.prototype,{setParentEl:function(a){this._parentEl=a},getParentEl:function(){return this._parentEl},makeElManager:function(a){var d={_model:a,createEl:function(){if(this._el=$(this._elHtml),$(this._parentEl).append(this._el),this._bindings)if(c.isString(this._bindings))this._modelBinder=new b.ModelBinder,this._modelBinder.bind(this._model,this._el,b.ModelBinder.createDefaultBindings(this._el,this._bindings));else{if(!c.isObject(this._bindings))throw"Unsupported bindings type, please use a boolean or a bindings hash";this._modelBinder=new b.ModelBinder,this._modelBinder.bind(this._model,this._el,this._bindings)}this.trigger("elCreated",this._model,this._el)},removeEl:function(){void 0!==this._modelBinder&&this._modelBinder.unbind(),this._el.remove(),this.trigger("elRemoved",this._model,this._el)},isElContained:function(a){return this._el===a||$(this._el).has(a).length>0},getModel:function(){return this._model},getEl:function(){return this._el}};return c.extend(d,this),d}}),b.CollectionBinder.ViewManagerFactory=function(a){if(c.bindAll(this),this._viewCreator=a,!c.isFunction(this._viewCreator))throw"viewCreator must be a valid function that accepts a model and returns a backbone view"},c.extend(b.CollectionBinder.ViewManagerFactory.prototype,{setParentEl:function(a){this._parentEl=a},getParentEl:function(){return this._parentEl},makeElManager:function(a,b){var d={_model:a,_nextEl:b,createEl:function(){this._view=this._viewCreator(a),c.isUndefined(this._nextEl)?$(this._parentEl).append(this._view.render(this._model).el):this._view.render(this._model).$el.insertBefore(this._nextEl),this.trigger("elCreated",this._model,this._view)},removeEl:function(){void 0!==this._view.close?this._view.close():(this._view.$el.remove(),console.log("warning, you should implement a close() function for your view, you might end up with zombies")),this.trigger("elRemoved",this._model,this._view)},isElContained:function(a){return this._view.el===a||this._view.$el.has(a).length>0},getModel:function(){return this._model},getView:function(){return this._view},getEl:function(){return this._view.$el}};return c.extend(d,this),d}})}.call(this)});
define("gallery/backbone-plugin/backbone-modelbinder/backbone-modelbinder",["underscore","jquery","backbone"],function(a){var b=a("backbone"),c=a("underscore");if(!b)throw"Please include Backbone.js before Backbone.ModelBinder.js";return b.ModelBinder=function(a){c.bindAll(this),this._modelSetOptions=a||{}},b.ModelBinder.VERSION="0.1.5",b.ModelBinder.Constants={},b.ModelBinder.Constants.ModelToView="ModelToView",b.ModelBinder.Constants.ViewToModel="ViewToModel",c.extend(b.ModelBinder.prototype,{bind:function(a,b,d,e){if(this.unbind(),this._model=a,this._rootEl=b,this._modelSetOptions=c.extend({},this._modelSetOptions,e),!this._model)throw"model must be specified";if(!this._rootEl)throw"rootEl must be specified";d?(this._attributeBindings=$.extend(!0,{},d),this._initializeAttributeBindings(),this._initializeElBindings()):this._initializeDefaultBindings(),this._bindModelToView(),this._bindViewToModel()},unbind:function(){this._unbindModelToView(),this._unbindViewToModel(),this._attributeBindings&&(delete this._attributeBindings,this._attributeBindings=void 0)},_initializeAttributeBindings:function(){var a,b,d,e,f;for(a in this._attributeBindings){if(b=this._attributeBindings[a],c.isString(b))d={elementBindings:[{selector:b}]};else if(c.isArray(b))d={elementBindings:b};else{if(!c.isObject(b))throw"Unsupported type passed to Model Binder "+d;d={elementBindings:[b]}}for(e=0;e<d.elementBindings.length;e++)f=d.elementBindings[e],f.attributeBinding=d;d.attributeName=a,this._attributeBindings[a]=d}},_initializeDefaultBindings:function(){var a,b,c,d,e;for(this._attributeBindings={},b=$("[name]",this._rootEl),a=0;a<b.length;a++)c=b[a],d=$(c).attr("name"),this._attributeBindings[d]?this._attributeBindings[d].elementBindings.push({attributeBinding:this._attributeBindings[d],boundEls:[c]}):(e={attributeName:d},e.elementBindings=[{attributeBinding:e,boundEls:[c]}],this._attributeBindings[d]=e)},_initializeElBindings:function(){var a,b,c,d,e,f,g;for(a in this._attributeBindings)for(b=this._attributeBindings[a],c=0;c<b.elementBindings.length;c++){if(d=b.elementBindings[c],e=""===d.selector?$(this._rootEl):$(d.selector,this._rootEl),0===e.length)throw"Bad binding found. No elements returned for binding selector "+d.selector;for(d.boundEls=[],f=0;f<e.length;f++)g=e[f],d.boundEls.push(g)}},_bindModelToView:function(){this._model.on("change",this._onModelChange,this),this.copyModelAttributesToView()},copyModelAttributesToView:function(a){var b,d;for(b in this._attributeBindings)(void 0===a||-1!==c.indexOf(a,b))&&(d=this._attributeBindings[b],this._copyModelToView(d))},_unbindModelToView:function(){this._model&&(this._model.off("change",this._onModelChange),this._model=void 0)},_bindViewToModel:function(){$(this._rootEl).delegate("","change",this._onElChanged),$(this._rootEl).delegate("[contenteditable]","blur",this._onElChanged)},_unbindViewToModel:function(){this._rootEl&&($(this._rootEl).undelegate("","change",this._onElChanged),$(this._rootEl).undelegate("[contenteditable]","blur",this._onElChanged))},_onElChanged:function(a){var b,c,d,e;for(b=$(a.target)[0],c=this._getElBindings(b),d=0;d<c.length;d++)e=c[d],this._isBindingUserEditable(e)&&this._copyViewToModel(e,b)},_isBindingUserEditable:function(a){return void 0===a.elAttribute||"text"===a.elAttribute||"html"===a.elAttribute},_getElBindings:function(a){var b,c,d,e,f,g,h=[];for(b in this._attributeBindings)for(c=this._attributeBindings[b],d=0;d<c.elementBindings.length;d++)for(e=c.elementBindings[d],f=0;f<e.boundEls.length;f++)g=e.boundEls[f],g===a&&h.push(e);return h},_onModelChange:function(){var a,b;for(a in this._model.changedAttributes())b=this._attributeBindings[a],b&&this._copyModelToView(b)},_copyModelToView:function(a){var c,d,e,f,g,h;for(g=this._model.get(a.attributeName),c=0;c<a.elementBindings.length;c++)for(d=a.elementBindings[c],e=0;e<d.boundEls.length;e++)f=d.boundEls[e],f._isSetting||(h=this._getConvertedValue(b.ModelBinder.Constants.ModelToView,d,g),this._setEl($(f),d,h))},_setEl:function(a,b,c){b.elAttribute?this._setElAttribute(a,b,c):this._setElValue(a,c)},_setElAttribute:function(a,d,e){switch(d.elAttribute){case"html":a.html(e);break;case"text":a.text(e);break;case"enabled":a.attr("disabled",!e);break;case"displayed":a[e?"show":"hide"]();break;case"hidden":a[e?"hide":"show"]();break;case"css":a.css(d.cssAttribute,e);break;case"class":var f=this._model.previous(d.attributeBinding.attributeName);c.isUndefined(f)||(f=this._getConvertedValue(b.ModelBinder.Constants.ModelToView,d,f),a.removeClass(f)),e&&a.addClass(e);break;default:a.attr(d.elAttribute,e)}},_setElValue:function(a,b){if(a.attr("type"))switch(a.attr("type")){case"radio":a.val()===b&&a.attr("checked","checked");break;case"checkbox":b?a.attr("checked","checked"):a.removeAttr("checked");break;default:a.val(b)}else a.is("input")||a.is("select")||a.is("textarea")?a.val(b):a.text(b)},_copyViewToModel:function(a,c){var d,e;c._isSetting||(c._isSetting=!0,this._setModel(a,$(c)),c._isSetting=!1,a.converter&&(d=this._model.get(a.attributeBinding.attributeName),e=this._getConvertedValue(b.ModelBinder.Constants.ModelToView,a,d),this._setEl($(c),a,e)))},_getElValue:function(a,b){switch(b.attr("type")){case"checkbox":return b.prop("checked")?!0:!1;default:return void 0!==b.attr("contenteditable")?b.html():b.val()}},_setModel:function(a,d){var e={},f=this._getElValue(a,d);f=this._getConvertedValue(b.ModelBinder.Constants.ViewToModel,a,f),e[a.attributeBinding.attributeName]=f;var g=c.extend({},this._modelSetOptions,{changeSource:"ModelBinder"});this._model.set(e,g)},_getConvertedValue:function(a,b,c){return b.converter&&(c=b.converter(a,c,b.attributeBinding.attributeName,this._model)),c}}),b.ModelBinder.CollectionConverter=function(a){if(this._collection=a,!this._collection)throw"Collection must be defined";c.bindAll(this,"convert")},c.extend(b.ModelBinder.CollectionConverter.prototype,{convert:function(a,c){return a===b.ModelBinder.Constants.ModelToView?c?c.id:void 0:this._collection.get(c)}}),b.ModelBinder.createDefaultBindings=function(a,b,c,d){var e,f,g,h,i={};for(e=$("["+b+"]",a),f=0;f<e.length;f++)if(g=e[f],h=$(g).attr(b),!i[h]){var j={selector:"["+b+'="'+h+'"]'};i[h]=j,c&&(i[h].converter=c),d&&(i[h].elAttribute=d)}return i},b.ModelBinder.combineBindings=function(a,b){c.each(b,function(b,c){var d={selector:b.selector};b.converter&&(d.converter=b.converter),b.elAttribute&&(d.elAttribute=b.elAttribute),a[c]=a[c]?[a[c],d]:d})},b.ModelBinder});
define("gallery/backbone-plugin/backbone-localStorage/backbone-localStorage",function(){return function(a,b){function c(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function d(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}return b.LocalStorage=window.Store=function(a){this.name=a;var b=this.localStorage().getItem(this.name);this.records=b&&b.split(",")||[]},a.extend(b.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(a){return a.id||(a.id=d(),a.set(a.idAttribute,a.id)),this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a)),this.records.push(a.id.toString()),this.save(),this.find(a)},update:function(b){return this.localStorage().setItem(this.name+"-"+b.id,JSON.stringify(b)),a.include(this.records,b.id.toString())||this.records.push(b.id.toString()),this.save(),this.find(b)},find:function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a.id))},findAll:function(){return a(this.records).chain().map(function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a))},this).compact().value()},destroy:function(b){return b.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+b.id),this.records=a.reject(this.records,function(a){return a===b.id.toString()}),this.save(),b)},localStorage:function(){return localStorage},jsonData:function(a){return a&&JSON.parse(a)},_clear:function(){var b=this.localStorage(),c=new RegExp("^"+this.name+"-");b.removeItem(this.name),a.chain(b).keys().filter(function(a){return c.test(a)}).each(function(a){b.removeItem(a)})},_storageSize:function(){return this.localStorage().length}}),b.LocalStorage.sync=window.Store.sync=b.localSync=function(a,c,d){var f,g,e=c.localStorage||c.collection.localStorage,h=$.Deferred&&$.Deferred();try{switch(a){case"read":f=void 0!=c.id?e.find(c):e.findAll();break;case"create":f=e.create(c);break;case"update":f=e.update(c);break;case"delete":f=e.destroy(c)}}catch(i){g=i.code===DOMException.QUOTA_EXCEEDED_ERR&&0===e._storageSize()?"Private browsing is unsupported":i.message}return f?(c.trigger("sync",c,f,d),d&&d.success&&("0.9.10"===b.VERSION?d.success(c,f,d):d.success(f)),h&&h.resolve(f)):(g=g?g:"Record Not Found",c.trigger("error",c,g,d),d&&d.error&&("0.9.10"===b.VERSION?d.error(c,g,d):d.error(g)),h&&h.reject(g)),d&&d.complete&&d.complete(f),h&&h.promise()},b.ajaxSync=b.sync,b.getSyncMethod=function(a){return a.localStorage||a.collection&&a.collection.localStorage?b.localSync:b.ajaxSync},b.sync=function(a,c,d){return b.getSyncMethod(c).apply(this,[a,c,d])},b.LocalStorage}(_,Backbone)});
define("gallery/backbone-plugin/backbone-paginator/backbone-paginator",[],function(){Backbone.Paginator=function(a,b,c){"use strict";var d=b.map(a.VERSION.split("."),function(a){return parseInt(a,10)}),e={};e.version="<%= pkg.version %>",e.clientPager=a.Collection.extend({useDiacriticsPlugin:!0,useLevenshteinPlugin:!0,sortColumn:"",sortDirection:"desc",lastSortColumn:"",fieldFilterRules:[],lastFieldFilterRules:[],filterFields:"",filterExpression:"",lastFilterExpression:"",defaults_ui:{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4},initialize:function(){this.on("add",this.addModel,this),this.on("remove",this.removeModel,this),this.setDefaults()},setDefaults:function(){var a=b.defaults(this.paginator_ui,this.defaults_ui);b.defaults(this,a)},addModel:function(a){this.origModels.push(a)},removeModel:function(a){var c=b.indexOf(this.origModels,a);this.origModels.splice(c,1)},sync:function(c,e,f){var g=this;this.setDefaults();var h={};b.each(b.result(g,"server_api"),function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),h[c]=a});var i=b.clone(g.paginator_core);b.each(i,function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),i[c]=a}),i=b.defaults(i,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),i=b.extend(i,{data:JSON.stringify(h),processData:!1,url:b.result(i,"url")},f);var j=!(0===d[0]&&9===d[1]&&10===d[2]),k=i.success;i.success=function(a,b,c){k&&(j?k(a,b,c):k(e,a,i)),e&&e.trigger&&e.trigger("sync",e,a,i)};var l=i.error;i.error=function(a){l&&l(e,a,i),e&&e.trigger&&e.trigger("error",e,a,i)};var m=i.xhr=a.ajax(i);return e&&e.trigger&&e.trigger("request",e,m,i),m},nextPage:function(a){this.currentPage<this.information.totalPages&&(this.currentPage=++this.currentPage,this.pager(a))},previousPage:function(a){this.currentPage>1&&(this.currentPage=--this.currentPage,this.pager(a))},goTo:function(a,b){void 0!==a&&(this.currentPage=parseInt(a,10),this.pager(b))},howManyPer:function(a){if(void 0!==a){var b=this.perPage;this.perPage=parseInt(a,10),this.currentPage=Math.ceil((b*(this.currentPage-1)+1)/a),this.pager()}},setSort:function(a,b){void 0!==a&&void 0!==b&&(this.lastSortColumn=this.sortColumn,this.sortColumn=a,this.sortDirection=b,this.pager(),this.info())},setFieldFilter:function(a){b.isEmpty(a)?(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules="",this.pager(),this.info()):(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=a,this.pager(),this.info())},doFakeFieldFilter:function(a){if(!b.isEmpty(a)){var c=this.origModels;return void 0===c&&(c=this.models),c=this._fieldFilter(c,a),""!==this.filterExpression&&(c=this._filter(c,this.filterFields,this.filterExpression)),c.length}},setFilter:function(a,b){void 0!==a&&void 0!==b&&(this.filterFields=a,this.lastFilterExpression=this.filterExpression,this.filterExpression=b,this.pager(),this.info())},doFakeFilter:function(a,c){if(void 0!==a&&void 0!==c){var d=this.origModels;return void 0===d&&(d=this.models),b.isEmpty(this.fieldFilterRules)||(d=this._fieldFilter(d,this.fieldFilterRules)),d=this._filter(d,a,c),d.length}},pager:function(a){var c=this,d=this.perPage,e=(c.currentPage-1)*d,f=e+d;void 0===c.origModels&&(c.origModels=c.models),c.models=c.origModels.slice(),""!==this.sortColumn&&(c.models=c._sort(c.models,this.sortColumn,this.sortDirection)),b.isEmpty(this.fieldFilterRules)||(c.models=c._fieldFilter(c.models,this.fieldFilterRules)),""!==this.filterExpression&&(c.models=c._filter(c.models,this.filterFields,this.filterExpression)),this.lastSortColumn===this.sortColumn&&this.lastFilterExpression===this.filterExpression&&b.isEqual(this.fieldFilterRules,this.lastFieldFilterRules)||(e=0,f=e+d,c.currentPage=1,this.lastSortColumn=this.sortColumn,this.lastFieldFilterRules=this.fieldFilterRules,this.lastFilterExpression=this.filterExpression),c.sortedAndFilteredModels=c.models.slice(),c.info(),c.reset(c.models.slice(e,f)),b.result(a,"success")},_sort:function(a,c,d){return a=a.sort(function(a,e){var f=a.get(c),g=e.get(c);if(b.isUndefined(f)||b.isUndefined(g)||null===f||null===g)return 0;if(f=f.toString().toLowerCase(),g=g.toString().toLowerCase(),"desc"===d)if(!f.match(/[^\-\d\.]/)&&f.match(/-?[\d\.]+/)&&!g.match(/[^\-\d\.]/)&&g.match(/-?[\d\.]+/)){if(g-0>f-0)return 1;if(f-0>g-0)return-1}else{if(g>f)return 1;if(f>g)return-1}else if(!f.match(/[^\-\d\.]/)&&f.match(/-?[\d\.]+/)&&!g.match(/[^\-\d\.]/)&&g.match(/-?[\d\.]+/)){if(g-0>f-0)return-1;if(f-0>g-0)return 1}else{if(g>f)return-1;if(f>g)return 1}if(a.cid&&e.cid){var h=a.cid,i=e.cid;if(i>h)return-1;if(h>i)return 1}return 0})},_fieldFilter:function(a,c){if(b.isEmpty(c))return a;var d=[];return b.each(a,function(a){var e=!0;b.each(c,function(c){if(!e)return!1;if(e=!1,"function"===c.type){var d=b.wrap(c.value,function(b){return b(a.get(c.field))});d()&&(e=!0)}else"required"===c.type?b.isEmpty(a.get(c.field).toString())||(e=!0):"min"===c.type?!b.isNaN(Number(a.get(c.field)))&&!b.isNaN(Number(c.value))&&Number(a.get(c.field))>=Number(c.value)&&(e=!0):"max"===c.type?!b.isNaN(Number(a.get(c.field)))&&!b.isNaN(Number(c.value))&&Number(a.get(c.field))<=Number(c.value)&&(e=!0):"range"===c.type?!b.isNaN(Number(a.get(c.field)))&&b.isObject(c.value)&&!b.isNaN(Number(c.value.min))&&!b.isNaN(Number(c.value.max))&&Number(a.get(c.field))>=Number(c.value.min)&&Number(a.get(c.field))<=Number(c.value.max)&&(e=!0):"minLength"===c.type?a.get(c.field).toString().length>=c.value&&(e=!0):"maxLength"===c.type?a.get(c.field).toString().length<=c.value&&(e=!0):"rangeLength"===c.type?b.isObject(c.value)&&!b.isNaN(Number(c.value.min))&&!b.isNaN(Number(c.value.max))&&a.get(c.field).toString().length>=c.value.min&&a.get(c.field).toString().length<=c.value.max&&(e=!0):"oneOf"===c.type?b.isArray(c.value)&&b.include(c.value,a.get(c.field))&&(e=!0):"equalTo"===c.type?c.value===a.get(c.field)&&(e=!0):"containsAllOf"===c.type?b.isArray(c.value)&&b.isArray(a.get(c.field))&&b.intersection(c.value,a.get(c.field)).length===c.value.length&&(e=!0):"pattern"===c.type?a.get(c.field).toString().match(c.value)&&(e=!0):e=!1}),e&&d.push(a)}),d},_filter:function(c,d,e){var f=this,g={};if(b.isString(d)?g[d]={cmp_method:"regexp"}:b.isArray(d)?b.each(d,function(a){g[a]={cmp_method:"regexp"}}):b.each(d,function(a,c){g[c]=b.defaults(a,{cmp_method:"regexp"})}),d=g,b.has(a.Paginator,"removeDiacritics")&&f.useDiacriticsPlugin&&(e=a.Paginator.removeDiacritics(e)),""===e||!b.isString(e))return c;var h=b.map(e.match(/\w+/gi),function(a){return a.toLowerCase()}),i="("+b.uniq(h).join("|")+")",j=new RegExp(i,"igm"),k=[];return b.each(c,function(c){var g=[];b.each(d,function(d,i){var k=c.get(i);if(k){var l=[];if(k=b.has(a.Paginator,"removeDiacritics")&&f.useDiacriticsPlugin?a.Paginator.removeDiacritics(k.toString()):k.toString(),"levenshtein"===d.cmp_method&&b.has(a.Paginator,"levenshtein")&&f.useLevenshteinPlugin){var m=a.Paginator.levenshtein(k,e);b.defaults(d,{max_distance:0}),m<=d.max_distance&&(l=b.uniq(h))}else l=k.match(j);l=b.map(l,function(a){return a.toString().toLowerCase()}),b.each(l,function(a){g.push(a)})}}),g=b.uniq(b.without(g,"")),b.isEmpty(b.difference(h,g))&&k.push(c)}),k},info:function(){var a=this,b={},c=a.sortedAndFilteredModels?a.sortedAndFilteredModels.length:a.length,d=Math.ceil(c/a.perPage);return b={totalUnfilteredRecords:a.origModels.length,totalRecords:c,currentPage:a.currentPage,perPage:this.perPage,totalPages:d,lastPage:d,previous:!1,next:!1,startRecord:0===c?0:(a.currentPage-1)*this.perPage+1,endRecord:Math.min(c,a.currentPage*this.perPage)},a.currentPage>1&&(b.previous=a.currentPage-1),a.currentPage<b.totalPages&&(b.next=a.currentPage+1),b.pageSet=a.setPagination(b),a.information=b,b},setPagination:function(a){var b=[],c=0,d=0,e=2*this.pagesInRange,f=Math.ceil(a.totalRecords/a.perPage);if(f>1)if(1+e>=f)for(c=1,d=f;d>=c;c++)b.push(c);else if(a.currentPage<=this.pagesInRange+1)for(c=1,d=2+e;d>c;c++)b.push(c);else if(f-this.pagesInRange>a.currentPage&&a.currentPage>this.pagesInRange)for(c=a.currentPage-this.pagesInRange;c<=a.currentPage+this.pagesInRange;c++)b.push(c);else for(c=f-e;f>=c;c++)b.push(c);return b},bootstrap:function(a){return b.extend(this,a),this.goTo(1),this.info(),this}}),e.clientPager.prototype.prevPage=e.clientPager.prototype.previousPage;var f=function(){var a=new c.Deferred;return a.reject(),a.promise()};return e.requestPager=a.Collection.extend({sync:function(c,e,f){var g=this;g.setDefaults();var h={};b.each(b.result(g,"server_api"),function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),h[c]=a});var i=b.clone(g.paginator_core);b.each(i,function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),i[c]=a}),i=b.defaults(i,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),f.data=f.data?JSON.stringify(b.extend(h,f.data)):JSON.stringify(h),i=b.extend(i,{data:JSON.stringify(h),processData:!1,url:b.result(i,"url")},f);var j=!(0===d[0]&&9===d[1]&&10===d[2]),k=i.success;i.success=function(a,b,c){k&&(j?k(a,b,c):k(e,a,i)),d[0]<1&&e&&e.trigger&&e.trigger("sync",e,a,i)};var l=i.error;i.error=function(a){l&&l(e,a,i),e&&e.trigger&&e.trigger("error",e,a,i)};var m=i.xhr=a.ajax(i);return e&&e.trigger&&e.trigger("request",e,m,i),m},setDefaults:function(){var a=this;b.defaults(a.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4}),b.each(a.paginator_ui,function(c,d){b.isUndefined(a[d])&&(a[d]=a.paginator_ui[d])})},requestNextPage:function(a){return void 0!==this.currentPage?(this.currentPage+=1,this.pager(a)):f()},requestPreviousPage:function(a){return void 0!==this.currentPage?(this.currentPage-=1,this.pager(a)):f()},updateOrder:function(a,b){return void 0!==a?(this.sortField=a,this.pager(b)):f()},goTo:function(a,b){return void 0!==a?(this.currentPage=parseInt(a,10),this.pager(b)):f()},howManyPer:function(a,b){return void 0!==a?(this.currentPage=this.firstPage,this.perPage=a,this.pager(b)):f()},info:function(){var a={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};return this.currentPage>1&&(a.previous=this.currentPage-1),this.currentPage<a.totalPages&&(a.next=this.currentPage+1),a.hasNext=a.next,a.hasPrevious=a.next,a.pageSet=this.setPagination(a),this.information=a,a},setPagination:function(a){var b=[],c=0,d=0,e=2*this.pagesInRange,f=Math.ceil(a.totalRecords/a.perPage);if(f>1)if(1+e>=f)for(c=1,d=f;d>=c;c++)b.push(c);else if(a.currentPage<=this.pagesInRange+1)for(c=1,d=2+e;d>c;c++)b.push(c);else if(f-this.pagesInRange>a.currentPage&&a.currentPage>this.pagesInRange)for(c=a.currentPage-this.pagesInRange;c<=a.currentPage+this.pagesInRange;c++)b.push(c);else for(c=f-e;f>=c;c++)b.push(c);return b},pager:function(a){return b.isObject(a)||(a={}),this.fetch(a)},url:function(){return void 0!==this.paginator_core&&void 0!==this.paginator_core.url?this.paginator_core.url:null},bootstrap:function(a){return b.extend(this,a),this.setDefaults(),this.info(),this}}),e.requestPager.prototype.nextPage=e.requestPager.prototype.requestNextPage,e.requestPager.prototype.prevPage=e.requestPager.prototype.requestPreviousPage,e}(Backbone,_,jQuery)});
define("gallery/backbone-plugin/backbone-routefilter/backbone-routefilter",function(a){var b=a("backbone"),c=a("underscore"),d=b.Router.prototype.route,e=function(){};c.extend(b.Router.prototype,{before:e,after:e,route:function(a,b,f){f||(f=this[b]);var g=c.bind(function(){var d,b=[a,c.toArray(arguments)];if(d=c.isFunction(this.before)?this.before:"undefined"!=typeof this.before[a]?this.before[a]:e,d.apply(this,b)!==!1){f&&f.apply(this,arguments);var g;g=c.isFunction(this.after)?this.after:"undefined"!=typeof this.after[a]?this.after[a]:e,g.apply(this,b)}},this);return d.call(this,a,b,g)}})});
define("gallery/backbone-plugin/backbone-validation/backbone-validation",function(){Backbone.Validation=function(a,b,c){var d={forceUpdate:!1,selector:"name",valid:Function.prototype,invalid:Function.prototype},e=function(a){return b.reduce(b.keys(a.validation),function(a,b){return a[b]=c,a},{})},f=function(c,d){var e=c.validation[d]||{};return b.isFunction(e)?e:b.isString(e)?c[e]:(b.isArray(e)||(e=[e]),b.reduce(e,function(c,d){return b.each(b.without(b.keys(d),"msg"),function(b){c.push({fn:a.Validation.validators[b],val:d[b],msg:d.msg})}),c},[]))},g=function(c,d,e,g){var h=f(c,d);return b.isFunction(h)?h.call(c,e,d,g):b.reduce(h,function(b,f){var h=f.fn.call(a.Validation.validators,e,d,f.val,c,g);return h===!1||b===!1?!1:h&&!b?f.msg||h:b},"")},h=function(a,c){var e,f,h=[],i=[],j=!0,k=b.clone(c);for(f in c)e=g(a,f,c[f],k),e&&(h.push(f),i.push(e),j=!1);return{invalidAttrs:h,errorMessages:i,isValid:j}},i=function(a,c){return{isValid:function(a){if(b.isString(a))return!g(this,a,this.get(a),this.toJSON());if(b.isArray(a)){for(var c=0;c<a.length;c++)if(g(this,a[c],this.get(a[c]),this.toJSON()))return!1;return!0}return a===!0&&this.validate(),this.validation?this._isValid:!0},validate:function(d,f){var g=this,i=!d,j=b.extend({},c,f),k=b.extend(e(g),g.toJSON(),d),l=d||k,m=h(g,k);g._isValid=m.isValid;for(var n in k){var o=b.indexOf(m.invalidAttrs,n);-1!==o&&(l.hasOwnProperty(n)||i)&&j.invalid(a,n,m.errorMessages[o],j.selector),b.include(m.invalidAttrs,n)||j.valid(a,n,j.selector)}return b.defer(function(){g.trigger("validated",g._isValid,g,m.invalidAttrs),g.trigger("validated:"+(g._isValid?"valid":"invalid"),g,m.invalidAttrs)}),!j.forceUpdate&&b.intersection(m.invalidAttrs,b.keys(l)).length>0?m.errorMessages:void 0}}},j=function(a,c,d){b.extend(c,i(a,d))},k=function(a){delete a.validate,delete a.isValid},l=function(a){j(this.view,a,this.options)},m=function(a){k(a)};return{version:"0.5.3",configure:function(a){b.extend(d,a)},bind:function(c,e){var f=c.model,g=c.collection,h=b.extend({},d,a.Validation.callbacks,e);f&&j(c,f,h),g&&(g.each(function(a){j(c,a,h)}),g.bind("add",l,{view:c,options:h}),g.bind("remove",m))},unbind:function(a){var b=a.model,c=a.collection;b&&k(a.model),c&&(c.each(function(a){k(a)}),c.unbind("add",l),c.unbind("remove",m))},mixin:i(null,d)}}(Backbone,_),Backbone.Validation.callbacks={valid:function(a,b,c){a.$("["+c+"~="+b+"]").removeClass("invalid").removeAttr("data-error")},invalid:function(a,b,c,d){a.$("["+d+"~="+b+"]").addClass("invalid").attr("data-error",c)}},Backbone.Validation.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},Backbone.Validation.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be grater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",pattern:"{0} must be a valid {1}",object:"{0} must be an object"},Backbone.Validation.validators=function(a,b,c){var d=String.prototype.trim?function(a){return null===a?"":String.prototype.trim.call(a)}:function(a){var b=/^\s+/,c=/\s+$/;return null===a?"":a.toString().replace(b,"").replace(c,"")},e=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();return b.replace(/\{(\d+)\}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})},f=function(b){return c.isNumber(b)||c.isString(b)&&b.match(a.number)},g=function(a){return!(c.isNull(a)||c.isUndefined(a)||c.isString(a)&&""===d(a))};return{fn:function(a,b,d,e,f){return c.isString(d)&&(d=e[d]),d.call(e,a,b,f)},required:function(a,d,f,h){var i=c.isFunction(f)?f.call(h):f;return i||g(a)?i&&!g(a)?e(b.required,d):void 0:!1},acceptance:function(a,d){return"true"===a||c.isBoolean(a)&&a!==!1?void 0:e(b.acceptance,d)},min:function(a,c,d){return!f(a)||d>a?e(b.min,c,d):void 0},max:function(a,c,d){return!f(a)||a>d?e(b.max,c,d):void 0},range:function(a,c,d){return!f(a)||a<d[0]||a>d[1]?e(b.range,c,d[0],d[1]):void 0},length:function(a,c,f){return g(a)&&d(a).length===f?void 0:e(b.length,c,f)},minLength:function(a,c,f){return!g(a)||d(a).length<f?e(b.minLength,c,f):void 0},maxLength:function(a,c,f){return!g(a)||d(a).length>f?e(b.maxLength,c,f):void 0},rangeLength:function(a,c,f){return!g(a)||d(a).length<f[0]||d(a).length>f[1]?e(b.rangeLength,c,f[0],f[1]):void 0},oneOf:function(a,d,f){return c.include(f,a)?void 0:e(b.oneOf,d,f.join(", "))},equalTo:function(a,c,d,f,g){return a!==g[d]?e(b.equalTo,c,d):void 0},pattern:function(c,d,f){return g(c)&&c.toString().match(a[f]||f)?void 0:e(b.pattern,d,f)},validation:function(a,d){return c.isObject(a)?void 0:e(b.object,d)}}}(Backbone.Validation.patterns,Backbone.Validation.messages,_)});
define("gallery/backbone-plugin/backbone-plugin", ["underscore","backbone"] ,function(require){
    window.Backbone = require("backbone");
    require('backbone-validation');
    Backbone.DeepModel = require('backbone-deepmodel');
    Backbone.ModelBinder = require('backbone-modelbinder');
    require('backbone-collectionbinder');
    require('backbone-routefilter');
    require('backbone-paginator');
    require('backbone-localStorage');
});

